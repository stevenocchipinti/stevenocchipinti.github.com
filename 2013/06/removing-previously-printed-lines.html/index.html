
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Printing over previously printed characters and lines - StevenOcchipinti.com</title>
  <meta name="author" content="Steven Occhipinti">

  
  <meta name="description" content="I recently wrote small Ruby Gem that provides a command line interface to Melbourne&rsquo;s TramTracker service. One main feature I wanted was to &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.stevenocchipinti.com/2013/06/removing-previously-printed-lines.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="StevenOcchipinti.com" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-38345732-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">StevenOcchipinti.com</a></h1>
  
    <h2>Coder.</h2>
  
</hgroup>

</header>
  <nav role="navigation">
  <form action="http://google.com/search" method="get">
    <fieldset role="search">
      <input type="hidden" name="q" value="site:blog.stevenocchipinti.com" />
      <input class="search" type="text" name="q" results="0" placeholder="Search"/>
    </fieldset>
  </form>

<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/archives">Archives</a></li>
  <li><a href="https://github.com/stevenocchipinti">Code</a></li>
  <li><a href="http://www.flickr.com/photos/stevenocchipinti">Photography</a></li>
  <li><a href="/travel">Travel</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Printing Over Previously Printed Characters and Lines</h1>
    
    
      <p class="meta">
        








  



  
<time datetime="2013-06-08T15:27:00+10:00" pubdate data-updated="true">Jun 8<span>th</span>, 2013</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>I recently wrote small <a href="https://github.com/stevenocchipinti/tramtracker">Ruby Gem</a> that provides a command line interface to Melbourne&rsquo;s <a href="http://yarratrams.com.au/tramtracker">TramTracker service</a>.</p>

<p>One main feature I wanted was to allow the script to poll TramTracker on a regular basis.<br/>
In the past, I used the command line utility watch to achieve this, but I couldn&rsquo;t find a way to enforce a &ldquo;max iterations&rdquo; option.
If it gets forgotten about in the background, TramTracker will eventually block that IP address!</p>

<p>So I turned to Ruby. Now instead of printing the same block of text over and over again and filling up the terminal, I thought it would be better to just have that text overwrite itself in place.</p>

<p>In this post, I&rsquo;ll outline a couple of ways of achieving this.</p>

<h2>Using the \b (backspace) character</h2>

<p>Printing a \b character does the same thing as pressing backspace. This is really simple to use and is great for little &ldquo;progress&rdquo; spinners.<br/>
For example, a character that cycles through <code>|</code>, <code>/</code>, <code>-</code>, <code>\</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">puts</span> <span class="s2">&quot;foo</span><span class="se">\b\b\b</span><span class="s2">bar&quot;</span>
</span><span class='line'><span class="c1"># =&gt; bar</span>
</span><span class='line'><span class="p">(</span><span class="s2">&quot;|/-</span><span class="se">\\</span><span class="s2">&quot;</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">chars</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span><span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="nb">print</span> <span class="n">c</span><span class="p">;</span> <span class="nb">sleep</span> <span class="mi">1</span><span class="p">;</span> <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\b</span><span class="s2">&quot;</span><span class="p">}</span>
</span><span class='line'><span class="c1"># =&gt; Cheesy, old-school spinner</span>
</span></code></pre></td></tr></table></div></figure>


<p>There are two main shortfalls with this approach, one is that it only works on a single line and two is that if you want to overwrite lots of characters, you&rsquo;d need just as many <code>\b</code> characters (you would probably introduce a loop).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">puts</span> <span class="s2">&quot;foo</span><span class="se">\n\b\b\b</span><span class="s2">bar&quot;</span>
</span><span class='line'><span class="c1"># =&gt; foo\nbar</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Using the \r (carriage return) character</h2>

<p>To avoid having to repeat just as many <code>\b</code> characters, a simple alternative would be to return the cursor to the start of the line and write over the top of the existing characters. For example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="mi">100</span><span class="o">.</span><span class="n">times</span> <span class="p">{</span><span class="o">|</span><span class="nb">p</span><span class="o">|</span> <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\r</span><span class="s2">Downloading %</span><span class="si">#{</span><span class="nb">p</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">;</span> <span class="nb">sleep</span> <span class="mi">1</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This approach still won&rsquo;t work across multiple lines, but it has another subtle shortfall too, it doesn&rsquo;t clear the entire line. For example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">puts</span> <span class="s2">&quot;foo</span><span class="se">\r</span><span class="s2">p&quot;</span>
</span><span class='line'><span class="c1"># =&gt; poo</span>
</span></code></pre></td></tr></table></div></figure>


<p>A common work around for this is to pad the end of the string with spaces, but there are better ways (keep reading ;) )</p>

<h2>Using curses</h2>

<p>The most common answer to overwriting characters across multiple lines, is to use <a href="http://en.wikipedia.org/wiki/Curses_(programming_library)">curses</a>.
Curses allows you to pick exactly with character you want to update and makes <a href="https://www.google.com.au/search?hl=en&amp;q=command+line+curses&amp;bav=on.2,or.r_cp.r_qf.&amp;bvm=bv.47534661,d.aGc&amp;biw=1366&amp;bih=679&amp;um=1&amp;ie=UTF-8&amp;tbm=isch&amp;source=og&amp;sa=N&amp;tab=wi&amp;ei=r0WzUbyWF4T-iAfn8IH4DA">menu driven Text User Interfaces</a> (TUI&rsquo;s) easier to develop.
Ruby happens to have a <a href="http://www.ruby-doc.org/stdlib-2.0/libdoc/curses/rdoc/Curses.html">curses module</a> built in to its standard library, which provides a simple API, for example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">setpos</span><span class="p">(</span><span class="n">lines</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">cols</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># Start in the middle</span>
</span><span class='line'><span class="n">addstr</span><span class="p">(</span><span class="s2">&quot;Hello world&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>I created a more complete (simple) example of using curses in a <a href="https://gist.github.com/stevenocchipinti/5703381">gist here</a>.</p>

<p>Curses is pretty good for this sort of stuff, it gives you a lot for free.
The thing that I didn&rsquo;t like about using the curses library was that when it initialises, it clears the screen.
This behaviour suits a TUI, and the old contents is still restored when you return, but I was being picky and didn&rsquo;t want that.</p>

<h2>Using individual cursor movement characters</h2>

<p>This last option is the most fundamental of the bunch. Terminals generally support characters that will allow you to move the cursor around at will and would be the basis of things like curses, although not as commonly used. Here are the most common characters to move the cursor around:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="p">\</span><span class="mo">033</span><span class="o">[&lt;</span><span class="n">L</span><span class="o">&gt;</span><span class="p">;</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span><span class="n">H</span> <span class="c1"># Move the cursor to line L, column C</span>
</span><span class='line'><span class="p">\</span><span class="mo">033</span><span class="o">[&lt;</span><span class="n">N</span><span class="o">&gt;</span><span class="n">A</span>     <span class="c1"># Move the cursor up N lines</span>
</span><span class='line'><span class="p">\</span><span class="mo">033</span><span class="o">[&lt;</span><span class="n">N</span><span class="o">&gt;</span><span class="n">B</span>     <span class="c1"># Move the cursor down N lines</span>
</span><span class='line'><span class="p">\</span><span class="mo">033</span><span class="o">[&lt;</span><span class="n">N</span><span class="o">&gt;</span><span class="n">C</span>     <span class="c1"># Move the cursor forward N columns</span>
</span><span class='line'><span class="p">\</span><span class="mo">033</span><span class="o">[&lt;</span><span class="n">N</span><span class="o">&gt;</span><span class="n">D</span>     <span class="c1"># Move the cursor backward N columns</span>
</span><span class='line'><span class="p">\</span><span class="mo">033</span><span class="o">[</span><span class="mi">2</span><span class="n">J</span>       <span class="c1"># Clear the screen, move to (0,0)</span>
</span><span class='line'><span class="p">\</span><span class="mo">033</span><span class="o">[</span><span class="n">K</span>        <span class="c1"># Erase to end of line</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can read more about these &ldquo;escape sequences&rdquo; <a href="http://www.linuxselfhelp.com/howtos/Bash-Prompt/Bash-Prompt-HOWTO-6.html#ss6.2">here</a>.
I ended up using the <code>\033[K</code> (&ldquo;Erase to end of line&rdquo;) and the <code>\033[A</code> (&ldquo;Move the cursor up&rdquo;) <a href="https://github.com/stevenocchipinti/tramtracker/blob/master/lib/formatters/polling_formatter.rb">characters in my TramTracker gem</a> and it worked a treat!</p>

<p>Now go and make a cool retro user interface! :)</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Steven Occhipinti</span></span>

      








  



  
<time datetime="2013-06-15T13:23:49+10:00" class="updated">Updated Jun 15<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/categories/bash/'>bash</a>, <a class='category' href='/categories/linux/'>linux</a>, <a class='category' href='/categories/programming/'>programming</a>, <a class='category' href='/categories/ruby/'>ruby</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://blog.stevenocchipinti.com/2013/06/removing-previously-printed-lines.html" data-via="steveocchipinti" data-counturl="http://blog.stevenocchipinti.com/2013/06/removing-previously-printed-lines.html" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2013/05/safe-mode-on-samsung-galaxy-s3.html" title="Previous Post: "Safe mode" on the Samsung Galaxy S3">&laquo; "Safe mode" on the Samsung Galaxy S3</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <ul class="social-icons">
    <li><a class="social-icon social-rss" href="/atom.xml" title="subscribe via RSS">RSS</a></li>
    <li><a class="social-icon social-github" href="https://github.com/stevenocchipinti" title="GitHub">GitHub</a></li>
    <li><a class="social-icon social-linkedin" href="http://au.linkedin.com/pub/steve-occhipinti/18/55/750" title="LinkedIn">LinkedIn</a></li>
    <li><a class="social-icon social-flickr" href="http://flickr.com/stevenocchipinti" title="Flickr">Flickr</a></li>
    <li><a class="social-icon social-twitter" href="http://twitter.com/steveocchipinti" title="Twitter">Twitter</a></li>
    <li><a class="social-icon social-facebook" href="http://facebook.com/stevenocchipinti" title="Facebook">Facebook</a></li>
  </ul>
  <div style="clear: both;"/>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2013/06/removing-previously-printed-lines.html">Printing Over Previously Printed Characters and Lines</a>
      </li>
    
      <li class="post">
        <a href="/2013/05/safe-mode-on-samsung-galaxy-s3.html">"Safe Mode" on the Samsung Galaxy S3</a>
      </li>
    
      <li class="post">
        <a href="/2013/03/how-to-make-tomato-sauce.html">How to Make Tomato Sauce</a>
      </li>
    
      <li class="post">
        <a href="/2013/01/script-to-transfer-photos-in-linux.html">Script to Transfer Photos in Linux</a>
      </li>
    
      <li class="post">
        <a href="/2012/12/a-few-photography-tips.html">A Few Photography Tips</a>
      </li>
    
  </ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Steven Occhipinti -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'stevenocchipinticom';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://blog.stevenocchipinti.com/2013/06/removing-previously-printed-lines.html';
        var disqus_url = 'http://blog.stevenocchipinti.com/2013/06/removing-previously-printed-lines.html';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
