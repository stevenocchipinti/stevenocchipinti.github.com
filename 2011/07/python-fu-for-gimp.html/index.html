
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->

<head>


<meta charset="utf-8">
<meta http-equiv="cleartype" content="on">

<title>Python-fu for the Gimp - Steven Occhipinti</title>
<meta name="author" content="Steven Occhipinti">




<meta name="description" content="When I learn something cool, I'll try to record it here so I don't forget and maybe someone else may benefit from it too">

<meta name="keywords" content="gimp linux programming python ">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Twitter Cards -->

  
    <meta name="twitter:card" content="summary">
    <meta name="twitter:image" content"">
  
  <meta name="twitter:title" content="Python-fu for The Gimp">
  <meta name="twitter:description" content="When I learn something cool, I'll try to record it here so I don't forget and maybe someone else may benefit from it too">
  <meta name="twitter:creator" content="@steveocchipinti">


<!-- Open Graph -->
<meta property="og:local" content="en_US">
<meta property="og:type" content="article">
<meta property="og:url" content="http://blog.stevenocchipinti.com/2011/07/python-fu-for-gimp.html">
<meta property="og:title" content="Python-fu for The Gimp">
<meta property="og:description" content="When I learn something cool, I'll try to record it here so I don't forget and maybe someone else may benefit from it too">

  <meta property="og:image" content="">

<meta property="og:site_name" content="Steven Occhipinti">

<link rel="canonical" href="http://blog.stevenocchipinti.com/2011/07/python-fu-for-gimp.html">
<link href="/favicon.ico" rel="icon">
<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
<link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
<link href="/atom.xml" rel="alternate" title="Steven Occhipinti" type="application/atom+xml">

<script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>
<script>Modernizr || document.write('<script src="/javascripts/vendor/modernizr-2.6.2.custom.min.js"><\/script>') </script>



<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">


</head>

<body id="post" class="feature">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
  <button class="dl-trigger">Open Menu</button>
  <ul class="dl-menu">
    <li>
      <a href="/"><i class="fa fa-home"></i>Home</a>
    </li>
    <li>
      <a href="#"><i class="fa fa-user"></i> About Me</a>
      <ul class="dl-submenu">
        <li>
          <img src="https://www.gravatar.com/avatar/207d31274969a51f4bbfedf875b54eb5.png?s=500" alt="Steven Occhipinti photo" class="author-photo">
          <h4>Steven Occhipinti</h4>
          <p></p>
        </li>
        
        
        <li>
          <a href="https://github.com/stevenocchipinti"><i class="fa fa-github"></i> GitHub</a>
        </li>
        <li>
          <a href="https://twitter.com/steveocchipinti"><i class="fa fa-twitter"></i> Twitter</a>
        </li>
        
        <li>
          <a href="http://flickr.com/stevenocchipinti"><i class="fa fa-flickr"></i> Flickr</a>
        </li>
        <li>
          <a href="http://facebook.com/stevenocchipinti"><i class="fa fa-facebook"></i> Facebook</a>
        </li>
        <li>
          <a href="http://au.linkedin.com/pub/steve-occhipinti/18/55/750"><i class="fa fa-linkedin"></i> LinkedIn</a>
        </li>
      </ul><!-- /.dl-submenu -->
    </li>
    <li>
      <a href="#"><i class="fa fa-bars"></i> Posts</a>
      <ul class="dl-submenu">
        <li>
          <a href="/posts/"><i class="fa fa-calendar"></i> By Year</a>
        </li>
        <li>
          <a href="/categories/"><i class="fa fa-tag"></i> By Category</a>
        </li>
      </ul>
    </li>
    <li>
      <a onclick="setTimeout(function() {$('.searchbox').focus();}, 500);" href="#"><i class="fa fa-search"></i> Search</a>
      <ul class="dl-submenu">
        <li>
          <style>
            .searchbox:focus {
              outline: 0;
            }
            .searchbox {
              background-color: #222;
              color: white;
              border: 0;
              height: 50px;
              width: 100%;
              padding-left: 20px;
            }
          </style>
          <form onsubmit="window.location.href='https://google.com/search?q=site:blog.stevenocchipinti.com+' + this.q.value;return false;" action="">
            <input class="searchbox" type="text" name="q" placeholder="Search">
          </form>
        </li>
      </ul>
    </li>
    <li>
      <a href="/projects/"><i class="fa fa-code"></i> Projects</a>
    </li>
    <li>
      <a href="/travel/"><i class="fa fa-plane"></i> Travel</a>
    </li>
    
  </ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->


<div class="entry-header">
  
  <div class="entry-image">
    
    <img src="/images/hero.jpg" alt="Python-fu for The Gimp">
    
  </div><!-- /.entry-image -->
</div><!-- /.entry-header -->

<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title"><a href="/2011/07/python-fu-for-gimp.html" rel="bookmark" title="Python-fu for The Gimp">Python-fu for The Gimp</a></h1>
        
        <h2>July 03, 2011</h2>
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <div class="css-full-post-content js-full-post-content">
I&#8217;ve been meaning to learn how to script The Gimp for a while now, but have never bothered to put the time aside to do it. Well, I finally did it, and this is why and how :)<br /><br /><b>The story:</b><br /><b>&nbsp;</b> <br />When I had my 21st birthday, my brother made the party invites for me. He added a whole bunch of photos and I&#8217;ve still got a copy of that with all my photos as a keepsake.<br />Now his birthday is coming up and I thought I would repay the favour.<br /><br />The Idea I had was to scan a bunch of old photos (like he did), then use The Gimp to make them look like printed photos (white border, drop shadow, kind of like polaroids) and scatter them around a &#8220;Happy Birthday&#8221; title.<br /><br />I spent quite a while scanning the photos, adding them all as layers to a single canvas, resizing them to suit and then individually adding white padding, a black stroke around the outside, dropping a shadow, rotating and moving each individual layer to lay it out nicely, I was finally happy with the end result and saved a .xcf and then exported a .jpg.<br />At this stage I had all the scans, a font, a background image, the .xcf and the .jpg all saved in a folder on my desktop. <br />I quit The Gimp, got a flash drive and copied the .jpg over so I got get it printed, shutdown the pc and went for dinner.<br /><br />When I got back quite some time later, my pc hadn&#8217;t quite shutdown yet, it just had a black screen.. So I left it a little longer and it still hadn&#8217;t shutdown, so I held down the power button to force it.<br />The next day, I got asked to make a small adjustment to the invite, and to my horror, I could not find the .xcf anywhere! I had the exported .jpg from the flash drive, but that wasn&#8217;t suitable to make the adjustment&#8230; something had happened and to this day I&#8217;m still not sure what, but I lost all my work&#8230; When I realised I had to redo all that work, that&#8217;s when I put time aside to learn how to script The Gimp!<br /><br /><b>Scripting The Gimp:</b><br /><br />I took a look at some code examples for The Gimp&#8217;s script-fu functionality and having never learned Lisp, it looked pretty foreign to me! That&#8217;s when I noticed there was a Python-fu equivalent (luckily).<br /><br />Using the Python Console from within Gimp is really easy!<br />It has a &#8220;Browse&#8221; button which brings up the &#8220;Python Procedure Browser&#8221; - which is a list of functions that interact with The Gimp.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-nKAIY9543z0/ThBPoNzjquI/AAAAAAAAAB8/TqfEJU2SvEI/s1600/gimp-console.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="267" src="http://1.bp.blogspot.com/-nKAIY9543z0/ThBPoNzjquI/AAAAAAAAAB8/TqfEJU2SvEI/s320/gimp-console.png" width="320" /></a></div><br />Using the filterbox at the top, you can easily find the python function that matches the action you would normally execute using The Gimp&#8217;s menus (such as a layer resize, or filter).<br />When you select the function, it will show you a basic man page on what it does and the parameters it takes, and applying this function will insert the code into the console with place holders for the parameters, which you can then simply modify and execute.<br /><br />After getting the basics from Googling around, I made a basic script that I just copied and pasted into the console when I wanted to execute the repetitive actions.<br />I then optimised the script by wrapping it in a function, doing all my actions in a separate context (as not to disturb the users context for things like selected brush, etc.) and also group all my actions in a single undo (to simplify the history and make it easy to undo what my script does).<br /><br /><b>Work-arounds:</b><br /><br />There are a couple of hacks in the script that I couldn&#8217;t work out the nice way around in a short period of time (I&#8217;m still a n00b).<br />Rather than working out how to fix it, I thought I would just describe them here. <br /><br />One of those being that to add a white border around a layer, I need to resize the layer with an offset, and this new extra space would not always be white (regardless of my selected background color). My work around was to add a white layer behind it and merge it down.<br /><br />The other hack was with stoking. To add a 1px black stroke around a layer, I normally just specify 1px black from the stroke dialogue (as opposed to using the selected brush). I could not find an equivalent to this in the Python API - it always used the selected brush. <br />As the default brushes include a 1px brush (and a 3px brush, but no 2px brush) I thought I&#8217;d use that, but to do a stroke around the outside of a layer, I needed to select-all, then stoke, but with a 1px brush, I could not specify I wanted that 1px to be on the inside of the selection. So stroking with this method put the line on the top and left sides, not on the bottom and right.<br />The hack I used here is to rotate 180 degrees, stroke and repeat.<br /><br />Not the most elegant of scripts, but this was my first attempt and got the job done.<br /><br /><b>Registering the script with The Gimp:</b><br /><br />So now that the script was working (albeit with work arounds) and I added the polish (function definition, separate context, grouped undo, etc.) I was ready to add it to the menus just like any other filter.<br />I used an existing script (located in ~/.gimp-2.6/plug-ins/) as a baseline and adjusted it for my new script (that I called &#8220;photofy&#8221;).<br />This part of the code allows you to specify the name of the script, where in the menu it should be registered and if there are any user-specified inputs to the script you can even specify a simple GUI for a dialogue box to get them from the user - which I did to collect the desired size of the white margin.<br />You can see this part of the code at the bottom of the python script.<br /><br /><b>Demo:</b><br /><br />So now the fun part, this is how you use it :)<br />Here is a simple image with 2 layers: a white background layer and a smaller subject layer (the gradient).<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-lpQOJzvaj44/Tgb-hNSxBwI/AAAAAAAAABs/baRi7vX9YCE/s1600/1.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="284" src="http://4.bp.blogspot.com/-lpQOJzvaj44/Tgb-hNSxBwI/AAAAAAAAABs/baRi7vX9YCE/s320/1.png" width="320" /></a></div><br />With the subject layer selected, navigate to the menu in which the &#8220;Photofy&#8221; script is registered.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-TfMu_L4Sgzw/Tgb-hx17ebI/AAAAAAAAABw/-Qz_f-nxCkU/s1600/2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="http://4.bp.blogspot.com/-TfMu_L4Sgzw/Tgb-hx17ebI/AAAAAAAAABw/-Qz_f-nxCkU/s320/2.png" width="262" /></a></div><br />The dialogue box that I specified in the script-fu code segment at the bottom of the script will appear and allow the user to enter the size of the white margin.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-9IyK0kdIzaQ/Tgb-iM-92pI/AAAAAAAAAB0/iDouukMupfw/s1600/3.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="170" src="http://1.bp.blogspot.com/-9IyK0kdIzaQ/Tgb-iM-92pI/AAAAAAAAAB0/iDouukMupfw/s320/3.png" width="320" /></a></div><br />When you press &#8220;OK&#8221;, the script will run through its actions and the user&#8217;s environment will remain the same, and the there will be a single new undo step in the history.<br />This is the final product:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-ZiLNMJ8g7iw/Tgb-ixVI8mI/AAAAAAAAAB4/o6nCg1vhxME/s1600/4.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="284" src="http://1.bp.blogspot.com/-ZiLNMJ8g7iw/Tgb-ixVI8mI/AAAAAAAAAB4/o6nCg1vhxME/s320/4.png" width="320" /></a></div><br /><b>The code:</b> <br /><br />If you&#8217;re interested in seeing what the code looks like, or want to use the script yourself (either as is, or as a baseline to write you own), it is available here:<br /><a href="https://github.com/stevenocchipinti/Gimp-Python-Fu/blob/master/photofy.py">https://github.com/stevenocchipinti/Gimp-Python-Fu/blob/master/photofy.py</a>
</div>

      <footer class="entry-meta">
        <span class="entry-tags"><a href="/categories/#gimp" title="Pages tagged gimp" class="tag">gimp</a><a href="/categories/#linux" title="Pages tagged linux" class="tag">linux</a><a href="/categories/#programming" title="Pages tagged programming" class="tag">programming</a><a href="/categories/#python" title="Pages tagged python" class="tag">python</a></span>
        <span><a href="/2011/07/python-fu-for-gimp.html" rel="bookmark" title="Python-fu for The Gimp">Python-fu for The Gimp</a> was published on <span class="entry-date date published updated"><time datetime="2011-07-03T11:52:00+10:00">July 03, 2011</time></span></span>
        
        <span class="author vcard"><span class="fn"><a href="" title="About Steven Occhipinti">Steven Occhipinti</a></span></span>
        
      </footer>
    </div><!-- /.entry-content -->
    
      <div class="read-more">
        
          <div class="read-more-header">
            <a href="/2016/12/28/windows-starting-up-by-itself-at-random-times/" class="btn">Read More</a>
          </div><!-- /.read-more-header -->
          <div class="read-more-content">
            <h3><a href="/2016/12/28/windows-starting-up-by-itself-at-random-times/" title="Windows starting up by itself at random times">Windows starting up by itself at random times</a></h3>
            <p>Windows starting up by itself at random times <a href="/2016/12/28/windows-starting-up-by-itself-at-random-times/"> Continue reading</a></p>
          </div><!-- /.read-more-content -->
        
        <div class="read-more-list">
          
            <div class="list-item">
              <h4><a href="/2015/06/01/rewriting-author-and-email-in-every-commit/" title="rewriting author and email in every commit">rewriting author and email in every commit</a></h4>
              <span>Published on June 01, 2015</span>
            </div><!-- /.list-item -->
          
            <div class="list-item">
              <h4><a href="/2015/05/26/how-to-keep-environment-variables-when-using-sudo/" title="How to keep environment variables when using sudo">How to keep environment variables when using sudo</a></h4>
              <span>Published on May 26, 2015</span>
            </div><!-- /.list-item -->
          
        </div><!-- /.read-more-list -->
      </div><!-- /.read-more -->
    
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2016 Steven Occhipinti. Powered by <a href="http://octopress.org">Octopress</a> using the <a href="https://github.com/jez/hpstr-theme/">HPSTR Theme for Octopress</a>.</span>

  </footer>
</div><!-- /.footer-wrapper -->


	        
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/javascripts/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/javascripts/octopress.js" type="text/javascript"></script>
<script src="/javascripts/scripts.min.js"></script>

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-38345732-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>




<script type="text/javascript">
      var disqus_shortname = 'stevenocchipinticom';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://blog.stevenocchipinti.com/2011/07/python-fu-for-gimp.html';
        var disqus_url = 'http://blog.stevenocchipinti.com/2011/07/python-fu-for-gimp.html';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	        

</body>
</html>
